<template lang="html">
  <button
    ref="btn"
    v-bind="$attrs"
    v-on="listeners"
    :class="[`vs-button-${isColor()?vsColor:null}`,`vs-button-${vsType}`,{
      'isActive':isActive,
      'includeIcon':vsIcon
      }]"
    :style="styles"
    class="vs-component vs-button"
    name="button"
    :disabled="disabled"
    >
      <span
      v-if="!is('line')&&!is('gradient')&&!is('relief')"
      ref="backgroundx"
      :style="stylesBackGround"
      class="vs-button-backgroundx"></span>

      <i :style="{
        'order':vsIconAfter?2:0,
        'margin-right':$slots.default&&!vsIconAfter?'5px':'0px',
        'margin-left':$slots.default&&vsIconAfter?'5px':'0px'
        }" class="material-icons vs-button-icon">
        {{vsIcon}}
      </i>

      <span v-if="$slots.default" class="vs-button-text">
        <slot>
        </slot>
      </span>

      <span
      class="vs-button-linex"
      :style="styleLine"
      ref="linex"></span>
  </button>
</template>

<script>
import _color from '../../utils/color.js'
export default {
  inheritAttrs:false,
  name:'vs-button',
  props:{
    vsType:{
      default:'filled',
      type:String
    },
    vsColor:{
      default:'primary',
      type:String
    },
    vsColorText:{
      default:null,
      type:String
    },
    vsLineOrigin:{
      default:'center',
      type:String
    },
    vsLinePosition:{
      default:'bottom',
      type:String
    },
    vsGradientDirection:{
      default:'30deg',
      type:String
    },
    vsGradientColorSecondary:{
      default:'primary',
      type:String
    },
    vsIcon:{
      type:String,
      default:null
    },
    vsIconAfter:{
      default:false,
      type:Boolean
    },
    disabled:{
      default: false,
      type: Boolean
    }
  },
  data:()=>({
    isActive:false,
    hoverx:false,
    leftBackgorund:20,
    topBackgorund:20,
    radio:0,
    time:0.3,
    timeOpacity:0.3,
    opacity:1,
  }),
  computed:{
    listeners() {
      return {
        ...this.$listeners,
        click: (event) => this.clickButton(event),
        blur: (event) => this.blurButton(event),
        mouseover: (event) => this.mouseoverx(event),
        mouseout: (event) => this.mouseoutx(event)
      }
    },
    styles() {
      if(this.is('filled')){
        return {
          color: _color.getColor(this.vsColorText,1),
          background: _color.getColor(this.vsColor,1),
          boxShadow: this.hoverx?`0px 8px 25px -8px ${_color.getColor(this.vsColor,1)}`:null
        }
      } else if (this.is('border') || this.is('flat')){
        return {
          border: `${this.is('flat')?0:1}px solid ${_color.getColor(this.vsColor,1)}`,
          background: this.hoverx?_color.getColor(this.vsColor,.1):'transparent',
          color:_color.getColor(this.vsColorText,1) || _color.getColor(this.vsColor,1)
        }
      } else if (this.is('line')) {
        return {
          color:_color.getColor(this.vsColorText,1) || _color.getColor(this.vsColor,1),
          borderBottomWidth: this.vsLinePosition=='bottom'?`2px`:null,
          borderColor: `${_color.getColor(this.vsColor,.2)}`,
          borderTopWidth: this.vsLinePosition=='top'?`2px`:null,
        }
      } else if (this.is('gradient')) {
        let backgroundx = `linear-gradient(${this.vsGradientDirection}, ${_color.getColor(this.vsColor)} 0%, ${_color.getColor(this.vsGradientColorSecondary,1)} 100%)`
        return {
          background: backgroundx,
        }
      } else if (this.is('relief')) {
        let color = _color.getColor(this.vsColor,1)
        return {
          background: _color.getColor(this.vsColor,1),
          boxShadow: `0 3px 0 0 ${_color.darken(color,-0.4)}`
        }
      }
    },
    stylesBackGround(){
      let styles = {
        background: this.is('flat') || this.is('border')?_color.getColor(this.vsColor,1,false):null,
        opacity:this.opacity,
        left: `${this.leftBackgorund}px`,
        top: `${this.topBackgorund}px`,
        width: `${this.radio}px`,
        height: `${this.radio}px`,
        transition: `width ${this.time}s ease, height ${this.time}s ease, opacity ${this.timeOpacity}s ease`
      }
      return styles

    },
    styleLine(){
      let lineOrigin = '50%'
      if(this.vsLineOrigin == 'left'){
        lineOrigin = '0%'
      } else if (this.vsLineOrigin == 'right') {
        lineOrigin = 'auto'
      }

      let styles = {
        top: this.vsLinePosition == 'top'?'-2px':'auto',
        bottom: this.vsLinePosition == 'bottom'?'-2px':'auto',
        background: _color.getColor(this.vsColor,1),
        left: lineOrigin,
        right: lineOrigin == 'auto'?'0px':null,
        transform: lineOrigin=='50%'?'translate(-50%)':null
      }
      return styles
    }
  },
  methods:{
    is(which){
      let type = this.vsType
      return type == which
    },
    mouseoverx(event){
      this.$emit('mouseover',event)
      this.hoverx = true
    },
    mouseoutx(event){
      this.$emit('mouseout',event)
      this.hoverx = false
    },
    blurButton(event){
      this.$emit('blur',event)
      if(this.vsType == 'border' || this.vsType == 'flat'){
        this.opacity = 0
        setTimeout( () => {
          this.radio = 0
        }, 150);
        this.isActive = false
      }
    },
    clickButton(event){
      this.$emit('click',event)
      if(this.isActive){
        return
      }
      this.isActive = true
      let btn = this.$refs.btn
      let xEvent = event.offsetX
      let yEvent = event.offsetY
      let radio = btn.clientWidth * 3
      this.time  = btn.clientWidth / (btn.clientWidth + (this.is('border') || this.is('flat')?70:20))
      if(this.is('filled')){
        this.timeOpacity = this.time
      }

      if(event.srcElement != btn) {
        xEvent += event.target.offsetLeft
        yEvent += event.target.offsetTop
      }
      this.leftBackgorund = xEvent
      this.topBackgorund = yEvent
      this.radio = radio
      if(this.is('filled')){
        this.opacity = 0
      } else {
        this.opacity = 1
      }

      if(this.is('filled')){
        setTimeout( () => {
          this.time = this.timeOpacity = this.radio = 0
          this.opacity = 1
          this.isActive = false
        }, this.time*1100);
      } else {
        setTimeout( () => {
          this.timeOpacity = .15
        }, this.time*1100);
      }

    },
    isColor(){
      return _color.isColor(this.vsColor)
    },
  }

}
</script>
